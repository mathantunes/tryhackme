# Matheus Jesus 01-05-2020

## Try Hack Me - [Basic Malware RE](https://tryhackme.com/room/basicmalwarere) @MalwareTechBlog

[Walktrough](https://medium.com/@davidagilman/malwaretech-beginner-malware-reversing-challenges-strings-walkthrough-9be8b234ddba)

### Static Analysis

#### Password for the ZIP is MalwareTech

### Strings1

```sh
#using radare2

rabin2 -I strings1.exe_
rabin2 -z strings1.exe_

# I have to find the value on memory address off_432294 [0x432294]
r2 strings1.exe_
pdf
#[0x432294:4]=0x424828 str.FLAG_CAN_I_MAKE_IT_ANYMORE_OBVIOUS

strings strings1.exe_  | grep OBVIOUS
#FLAG{CAN-I-MAKE-IT-ANYMORE-OBVIOUS}
```

```sh
48: entry0 ();
│           ; var LPCSTR lpText @ ebp-0x4
│           0x004022b0      55             push ebp
│           0x004022b1      8bec           mov ebp, esp
│           0x004022b3      51             push ecx
│           0x004022b4      a194224300     mov eax, dword [0x432294]   ; [0x432294:4]=0x424828 str.FLAG_CAN_I_MAKE_IT_ANYMORE_OBVIOUS
│           0x004022b9      50             push eax                    ; int32_t arg_8h
│           0x004022ba      e8d1ffffff     call sym char * __cdecl md5_hash(char *) ; sym.plaintext1.exe_char_____cdecl_md5_hash_char
│           0x004022bf      83c404         add esp, 4
│           0x004022c2      8945fc         mov dword [lpText], eax
│           0x004022c5      6a30           push 0x30                   ; '0' ; 48 ; UINT uType
│           0x004022c7      6854eb4200     push str.We_ve_been_compromised ; 0x42eb54 ; "We've been compromised!" ; LPCSTR lpCaption
│           0x004022cc      8b4dfc         mov ecx, dword [lpText]
│           0x004022cf      51             push ecx                    ; LPCSTR lpText
│           0x004022d0      6a00           push 0                      ; HWND hWnd
│           0x004022d2      ff1508304000   call dword [sym.imp.USER32.dll_MessageBoxA] ; 0x403008 ; "(\xec\x02" ; int MessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)
│           0x004022d8      6a00           push 0                      ; UINT uExitCode
└           0x004022da      ff1500304000   call dword [sym.imp.KERNEL32.dll_ExitProcess] ; 0x403000 ; VOID ExitProcess(UINT uExitCode)

```

[Ref - Radare2](https://blog.techorganic.com/2016/03/08/radare-2-in-0x1e-minutes/)
[Ref R2](http://www.ozgurcatak.org/files/02-static_analysis.pdf)

### Strings2

```sh
rabin2 -z strings2.exe_
# 0x004030e2

objdump -d strings2.exe_ > asm
#dump assembly code on asm file
```

[asm line 1647](./strings2/asm)
There is a bunch of movb calls moving bytes around.
Gather all bytes
`464c41477b535441434b2d535452494e47532d4152452d424553542d535452494e47537d`
back to string -> FLAG{STACK-STRINGS-ARE-BEST-STRINGS}

### Strings3

Meant to be done on windows

There is a weird operation that results in 272
a Uid pointer is set to that address
LoadStringA function is called on kernel

Using `Resource Hacker` tool, it is possible to acquire flag
[ref](https://medium.com/@thwalkde/malwaretech-beginner-malware-challenge-strings3-59f56429efd8)

`FLAG{RESOURCES-ARE-POPULAR-FOR-MALWARE}`